.. _2_2:

RareLink-CDM
=============

.. attention:: 
   RareLink v2.0.0.dev0 is under development (the REDCap sheets may be subject
   to change). Please :ref:`12` us before using it to ensure you have the latest 
   updates and guidance.


In this section, we provide an overview of the instruments that are part of the
RareLink Common Data Model (CDM), which is based on the :ref:`1_5`. 
We have implemented the :ref:`1_5`'s definitions, codes, and mappins 
into the REDCap instruments by encoding the variables and value sets in the
REDCap data dictionary. Each section of the model corresponds to a distinct
instrument, ensuring consistency and comprehensive data capture.

.. hint:: 
    - Read the :ref:`1_6` page to understand how REDCap instruments data dictionaries work.
    - Read the :ref:`1_5` page for more information on the Rare Disease Common Data Model.


Contents
----------

- :ref:`rarelink_cdm_datadictionary`
- :ref:`rarelink_cdm_linkml`
- :ref:`rule-set`
- :ref:`field-anotations`
- :ref:`cdm_overview`


_____________________________________________________________________________________

.. _rarelink_cdm_datadictionary:

REDCap Data Dictionary
-----------------------

The RareLink CDM Data Dictionary is available for download as a CSV file:

:download:`Download: RareLink-CDM Data Dictionary (v2.0.0.dev0) <../../res/rarelink_cdm_datadictionary - v2_0_0_dev0.csv>`

... Next steps
________________

- ... read :ref:`3_1` for more information on how to manually import and set up
  the RareLink-CDM Data Dictionary into your local REDCap project.
- ... or run the following commands to directly import the data dictionary into 
  your REDCap project using the :ref:`2_3`:

.. code-block:: bash

    rarelink setup keys
    rarelink setup data-dictionary

Return to `Top <#top>`_.

_____________________________________________________________________________________

.. _rarelink_cdm_linkml:

LinkML Schema
---------------

The RareLink-CDM has been encoded in the LinkML schema format to allow for
interoperability with other data models and standards. The LinkML schema
is an open-data modeling language and provides a machine-readable representation
of the RareLink-CDM, including the data elements, codes, and mappings to other 
standards. In other words, the RareLink REDCap instruments are displayed in a
structured format that so that LinkML modules and functionalities can be used.


- Here you can view the `LinkML schema of the RareLink-CDM v2.0.0.dev0 <https://github.com/BIH-CEI/rarelink/tree/develop/src/rarelink_cdm/v2_0_0_dev0>`_. 

Usage 
_______

We use RareLink-CDM-LinkML schema and functionalities in various RareLink 
modules, for example:

- When running ``rarelink redcap export-records`` you will see, that the data 
  from the REDCap project is automatically processed to the LinkML presentation
  of the RareLink-CDM and validated against it. This ensures the data is ready 
  to :ref:`4_3`. 
- Within the data model itself, we use its `python classes and properties <https://github.com/BIH-CEI/rarelink/tree/develop/src/rarelink_cdm/v2_0_0_dev0/datamodel>`_ 
  automatically generated by LinkML schema to ensure consistent use of code 
  systems, versions and codes within one RareLink-CDM version and its mappings.
- Since our RareLink-CDM is modeled and defined with LinkML, we can make use 
  of the `LinkML Schema Automator <https://github.com/linkml/schema-automator>`_ 
  for :ref:`4_2` from existing (tabular) databases. This allows import it into
  a REDCap project and allow you to :ref:`4_3` or :ref:`4_4`. 

LinkML - furhther links
________________________

To know more about LinkML, check out:

- The `LinkML GitHub repository <https://github.com/linkml/linkml>`_  or
- the `LinkML Schema Documentation <https://linkml.io/linkml/schemas/>`_. 

Feel free to :ref:`12` us in case you would like to be connected to the LinkML 
community or our colleagues from the `Monarch Initiative <https://monarchinitiative.org/>`_.



Return to `top <#top>`_.


_____________________________________________________________________________________

.. _rule-set:

Rules for REDCap codes and codesystems
---------------------------------------

REDCap variables and choice codes have specific limitations and requirements:

- REDCap recommends a maximum of 26 characters for variable names. We have 
  shortened the variable names to adhere to this limitation.
- REDCap variables must be unique and must not contain spaces or special 
  characters, i.e. only alphanumeric characters and underscores.
- REDCap choice codes must be unique and must not contain spaces or special 
  characters, i.e. only alphanumeric characters and underscores.

To address these, we have defined a set of rules for the REDCap variables and
choice codes in the RareLink CDM Data Dictionary. The rules are as follows:

1) The REDCap variable names are based on the :ref:`1_5` codes and display names.
2) The REDCap choices are based on the :ref:`1_5` codes and display names.
3) The REDCap variable names are shortened to adhere to the 26-character limit.
4) The REDCap variable names are unique and do not contain spaces or special characters.
5) The REDCap choice codes are unique and do not contain spaces or special characters.
6) All codes begin with the official codesystem prefix (e.g. HP, SNOMED, etc.) as a lower case string followed by an underscore and the code.
7) All codes are defined in the Field Annotations of each data element.

Return to `top <#top>`_.

_____________________________________________________________________________________

.. _field-anotations:

REDCap Field Annotations
-------------------------

Witin the Field Annotation field of each REDCap element, we have defined each 
element's metadata according to the :ref:`1_5` standard, including the following:

- **Variable**: Corresponding to the data element code, codesystem, and display name.
- **Choices**: If applicable, the corresponding choices codesystem, and display name.
- **Version(s)**: If applicable, the corresponding codesystem versions used in the REDCap data element
- **Mapping**: If applicable, the corresponding mapping to the :ref:`1_4` or :ref:`1_3` standard.

Example Field Annotation of 6.2.6 Temporal Pattern:

.. code-block:: bash
  
    Variable: 
    HP:0012824 | Severity  
    Choices: 
    - HP:0012827 | Borderline  
    - HP:0012825 | Mild  
    - HP:0012826 | Moderate  
    - HP:0012829 | Profound  
    - HP:0012828 | Severe  
    Version(s): 
    - HPO Version 2024-08-13  
    Mapping: 
    - HL7 FHIR Expression v4.0.1: Observation.interpretation  
    - GA4GH Phenopacket Schema v2.0 Element: PhenotypicFeature.severity

Return to `top <#top>`_.

_____________________________________________________________________________________

.. _cdm_overview:

RareLink-CDM Instruments
-------------------------

The RareLink-CDM instruments translate the `ontology-based Rare Disease Common Data Model (RD-CDM) <https://rarelink.readthedocs.io/en/latest/1_background/1_5_rd_cdm.html>`_
into REDCap instruments, ensuring usability for registry implementation while 
aligning with the `HL7 FHIR International Patient Summary (IPS) <https://build.fhir.org/ig/HL7/fhir-ips/>`_
and the `GA4GH Phenopacket Schema <https://rarelink.readthedocs.io/en/latest/1_background/1_3_ga4gh_phenopacket_schema.html>`_.
Each instrument corresponds to a specific section of the RD-CDM and has been 
adapted for REDCap's technical requirements.

- :ref:`formal-criteria`
- :ref:`personal-information`
- :ref:`patient-status`
- :ref:`care-pathway`
- :ref:`disease`
- :ref:`genetic-findings`
- :ref:`phenotypic-features`
- :ref:`measurements`
- :ref:`family-history`
- :ref:`consent`
- :ref:`disability`

Return to `Top <#top>`_.

.. note:: 
    to be implemented.

.. _formal-criteria:

(1) Formal Criteria
_____________________

**Purpose**: Captures eligibility and registration information for individuals.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _personal-information:

(2) Personal Information
__________________________

**Purpose**: Records demographic and personal data.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _patient-status:

(3) Patient Status
____________________

**Purpose**: Tracks changes in patient conditions over time.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _care-pathway:

(4) Care Pathway
__________________

**Purpose**: Logs encounter-specific data.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _disease:

(5) Disease
____________

**Purpose**: Details disease history and ontology mappings.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _genetic-findings:

(6.1) Genetic Findings
_________________________

**Purpose**: Captures genetic variant information.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _phenotypic-features:

(6.2) Phenotypic Features
__________________________

**Purpose**: Encodes phenotypes and their modifiers.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:

- **Simplified Field Names**: Shortened and formatted for REDCap constraints:

  - `snomedct_439272007_704321009_363778006` -> `snomedct_8116006_date`
  - `ga4gh_phenotypicfeature_excluded` -> `ga4gh_pheno_excluded`

- **Modifiers Grouping**: Introduced consistent naming for modifiers:

  - HPO Modifiers:

    - `ga4gh_phenotypicfeature_modifier_hp_1` -> `ga4gh_pheno_mod_hp1`
    - `ga4gh_phenotypicfeature_modifier_hp_2` -> `ga4gh_pheno_mod_hp2`
    - `ga4gh_phenotypicfeature_modifier_hp_3` -> `ga4gh_pheno_mod_hp3`

  - NCBITaxon Modifiers:

    - `ga4gh_phenotypicfeature_modifier_ncbitaxon_1` -> `ga4gh_pheno_mod_ncbitax1`
    - `ga4gh_phenotypicfeature_modifier_ncbitaxon_2` -> `ga4gh_pheno_mod_ncbitax2`
    - `ga4gh_phenotypicfeature_modifier_ncbitaxon_3` -> `ga4gh_pheno_mod_ncbitax3`

  - SNOMED Modifiers:

    - `ga4gh_phenotypicfeature_modifier_snomedct_1` -> `ga4gh_pheno_mod_snomed1`
    - `ga4gh_phenotypicfeature_modifier_snomedct_2` -> `ga4gh_pheno_mod_snomed2`
    - `ga4gh_phenotypicfeature_modifier_snomedct_3` -> `ga4gh_pheno_mod_snomed3`

**Adjustments from the RD-CDM**:

- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _measurements:

(6.3) Measurements
____________________

**Purpose**: Records clinical and laboratory data.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _family-history:

(6.4) Family History
______________________

**Purpose**: Details familial relationships and genetic predispositions.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _consent:

(7) Consent
_____________

**Purpose**: Documents patient consent details.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.

.. _disability:

(8) Disability
_______________

**Purpose**: Captures ICF-encoded functional and disability data.

**Core Variables**:
- [Insert Core Variables Here]

**Adjustments for REDCap**:
- [Insert Adjustments for REDCap Here]

**Adjustments from the RD-CDM**:
- [Insert Adjustments from the RD-CDM Here]

Return to `Instruments Overview <#cdm-instruments-overview>`_.